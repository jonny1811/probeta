
<!doctype>
<html>

<head>
	https://cdnjs.cloudflare.com/ajax/libs/bignumber.js/4.0.4/bignumber.min.js
</head>
<body>
    <h1>contract</h1>
    <div id="code"></div> 
    <div id="status"></div>
    <div id='create'>
        <button type="button" onClick="createExampleContract();">create example contract</button>
    </div>
    <div id='call' style='visibility: hidden;'>
        <input type="number" id="value" onkeyup='callExampleContract()'></input>
    </div>
    <div id="result"></div>
	

<script type="text/javascript">
	web3.version.getNetwork((err, netId) => {
					switch (netId) {
					  case "1":
						$("#network").text('This is Main network.')
						break
					  case "2":
						$("#network").text('This is TestNet network.')
						/*$("body").empty().append('please switch to Main network and reload this Dapp');*/
						break
					  case "3":
						$("#network").text('This is TestNet network.')
						/*$("body").empty().append('please switch to Main network and reload this Dapp');*/
						break
					  default:
					  $("#network").text('This is TestNet network.')
					  /*$("body").empty().append('please switch to Main network and reload this Dapp');*/
					}
    var Web3 = require('web3');
    var web3 = new Web3();
    web3.setProvider(new web3.providers.HttpProvider("http://localhost:8545"));
    // solidity code code
    var source = "" +
    "pragma solidity ^0.4.6;" +
    "contract test {\n" +
    "   function multiply(uint a) constant returns(uint d) {\n" +
    "       return a * 7;\n" +
    "   }\n" +
    "}\n";
    var compiled = web3.eth.compile.solidity(source);
    var code = compiled.code;
    // contract json abi, this is autogenerated using solc CLI
    var abi = compiled.info.abiDefinition;
    var myContract;
    function createExampleContract() {
        // hide create button
        document.getElementById('create').style.visibility = 'hidden'; 
        document.getElementById('code').innerText = code;
        // let's assume that coinbase is our account
        web3.eth.defaultAccount = web3.eth.coinbase;
        // create contract
        document.getElementById('status').innerText = "transaction sent, waiting for confirmation";
        web3.eth.contract(abi).new({data: code}, function (err, contract) {
            if(err) {
                console.error(err);
                return;
            // callback fires twice, we only want the second call when the contract is deployed
            } else if(contract.address){
                myContract = contract;
                console.log('address: ' + myContract.address);
                document.getElementById('status').innerText = 'Mined!';
                document.getElementById('call').style.visibility = 'visible';
            }
        });
    }
    function callExampleContract() {
        // this should be generated by ethereum
        var param = parseInt(document.getElementById('value').value);
        // call the contract
        var res = myContract.multiply(param);
        document.getElementById('result').innerText = res.toString(10);
    }
</script>

<script type="text/javascript">
		  window.addEventListener('load', function() {
			// Checking if Web3 has been injected by the browser (Mist/MetaMask)
			if (typeof web3 !== 'undefined') {
			  // Use Mist/MetaMask's provider
			  window.web3 = new Web3(web3.currentProvider);
			  console.log('I sense web3...')
			} else {
			  $("body").empty().append('<h1>This Dapp requires Metamask</h1><a href="https://metamask.io/" target="__blank"><img src="https://github.com/MetaMask/faq/raw/master/images/download-metamask.png"/></a>');
			}
		  })
		</script>

<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
</body>
</html>